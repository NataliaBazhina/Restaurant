{% extends "reservation/home.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}

{% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
{% endif %}

<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="display-5">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
            <span class="badge bg-primary fs-6">{{ user.email }}</span>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">üë§ –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Email:</strong> {{ user.email }}</p>
                        {% if user.first_name %}
                        <p><strong>–ò–º—è:</strong> {{ user.first_name }}</p>
                        {% endif %}
                        {% if user.last_name %}
                        <p><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ user.last_name }}</p>
                        {% endif %}
                        {% if user.phone %}
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ user.phone }}</p>
                        {% else %}
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω</span></p>
                        {% endif %}
                        <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> {{ user.date_joined|date:"d.m.Y" }}</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <!-- –ö–Ω–æ–ø–∫–∏ CRUD -->
                        <div class="d-flex flex-column gap-2 align-items-end">
                            <a href="{% url 'users:user_update' user.pk %}" class="btn btn-outline-primary">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                            </a>
                            <a href="{% url 'users:user_delete' user.pk %}" class="btn btn-outline-danger">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                            </a>
                            <a href="{% url 'users:logout' %}" class="btn btn-outline-secondary">
                                üëã –í—ã–π—Ç–∏
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">üìÖ –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π</h5>
                        <h3 class="text-primary">{{ user.reservations.count }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ</h5>
                        <h3 class="text-success">{{ active_reservations.count }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">üìã –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</h5>
                        <h3 class="text-secondary">{{ past_reservations.count }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">üìÖ –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
            </div>
            <div class="card-body">
                {% if active_reservations %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–°—Ç–æ–ª–∏–∫</th>
                                <th>–ì–æ—Å—Ç–µ–π</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in active_reservations %}
                            <tr>
                                <td>{{ reservation.date }}</td>
                                <td>{{ reservation.start_time }}</td>
                                <td>‚Ññ{{ reservation.table.number }}</td>
                                <td>{{ reservation.guests_count }}</td>
                                <td>
                                    <span class="badge {% if reservation.status == 'confirmed' %}bg-success{% elif reservation.status == 'completed' %}bg-info{% else %}bg-warning{% endif %}">
                                        {{ reservation.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'reservation:reservations_update' reservation.pk %}" class="btn btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                            ‚úèÔ∏è
                                        </a>
                                        <a href="{% url 'reservation:reservations_delete' reservation.pk %}" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                            üóëÔ∏è
                                        </a>
                                        <a href="{% url 'reservation:reservations_detail' reservation.pk %}" class="btn btn-outline-info" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">
                                            üëÅÔ∏è
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <p class="text-muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>
                    <a href="{% url 'reservation:reservations_create' %}" class="btn btn-primary">
                        üçΩÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü—Ä–æ—à–ª—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        {% if past_reservations %}
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">üìã –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–°—Ç–æ–ª–∏–∫</th>
                                <th>–ì–æ—Å—Ç–µ–π</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ—Ç–∞–ª–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in past_reservations %}
                            <tr>
                                <td>{{ reservation.date }}</td>
                                <td>{{ reservation.start_time }}</td>
                                <td>‚Ññ{{ reservation.table.number }}</td>
                                <td>{{ reservation.guests_count }}</td>
                                <td>
                                    <span class="badge bg-secondary">
                                        {{ reservation.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'reservation:reservations_detail' reservation.pk %}" class="btn btn-sm btn-outline-info">
                                        üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="mt-4 text-center">
            <div class="btn-group" role="group">
                <a href="{% url 'reservation:reservations_create' %}" class="btn btn-primary btn-lg">
                    üçΩÔ∏è –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </a>
                <a href="{% url 'reservation:reservations_list' %}" class="btn btn-outline-primary btn-lg">
                    üìã –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                </a>
                <a href="{% url 'users:user_update' user.pk %}" class="btn btn-outline-secondary btn-lg">
                    üë§ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}